<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Moldes STL</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: Arial, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            min-height: 100vh; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            padding: 15px; 
        }
        .container { 
            background: rgba(255, 255, 255, 0.95); 
            border-radius: 20px; 
            padding: 25px; 
            max-width: 500px; 
            width: 100%; 
            text-align: center; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.2); 
        }
        h1 { color: #333; margin-bottom: 15px; font-size: 1.8em; }
        .device { 
            background: rgba(102, 126, 234, 0.1); 
            padding: 8px 15px; 
            border-radius: 15px; 
            margin-bottom: 20px; 
            font-size: 0.85em; 
            color: #555; 
        }
        .upload { 
            border: 3px dashed #667eea; 
            border-radius: 15px; 
            padding: 30px 15px; 
            margin: 20px 0; 
            cursor: pointer; 
            background: rgba(102, 126, 234, 0.05); 
            transition: all 0.3s; 
            position: relative; 
        }
        .upload:hover { border-color: #764ba2; background: rgba(118, 75, 162, 0.1); transform: translateY(-2px); }
        .upload input { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; }
        .controls { 
            display: none; 
            margin: 20px 0; 
            padding: 15px; 
            background: rgba(102, 126, 234, 0.1); 
            border-radius: 10px; 
            text-align: left; 
        }
        .control { margin: 10px 0; }
        .control label { display: block; margin-bottom: 5px; font-weight: bold; color: #333; font-size: 0.9em; }
        .row { display: flex; align-items: center; gap: 10px; }
        input[type="range"] { flex: 1; height: 25px; }
        input[type="number"] { width: 60px; padding: 3px; border: 1px solid #ddd; border-radius: 3px; text-align: center; }
        .btn { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            border: none; 
            padding: 12px 25px; 
            border-radius: 20px; 
            font-size: 1em; 
            cursor: pointer; 
            margin: 8px 0; 
            width: 100%; 
            max-width: 250px; 
            transition: all 0.3s; 
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3); }
        .result { 
            display: none; 
            margin: 20px 0; 
            padding: 15px; 
            background: rgba(76, 175, 80, 0.1); 
            border-radius: 10px; 
            border: 2px solid #4caf50; 
        }
        .error { 
            display: none; 
            margin: 15px 0; 
            padding: 10px; 
            background: rgba(244, 67, 54, 0.1); 
            border: 1px solid #f44336; 
            border-radius: 8px; 
            color: #d32f2f; 
            font-size: 0.9em; 
        }
        .info { 
            background: rgba(76, 175, 80, 0.1); 
            padding: 10px; 
            border-radius: 8px; 
            margin: 10px 0; 
            font-size: 0.85em; 
            color: #2e7d32; 
        }
        @media (max-width: 480px) {
            .container { padding: 20px; margin: 10px; }
            h1 { font-size: 1.6em; }
            .upload { padding: 25px 10px; }
            .row { flex-direction: column; gap: 5px; }
            input[type="range"] { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè≠ Generador de Moldes STL</h1>
        <p style="margin-bottom: 15px; color: #666; font-size: 0.9em;">Genera moldes con encastres para impresi√≥n 3D</p>

        <div class="device" id="device">üì± Detectando dispositivo...</div>

        <div class="upload" onclick="document.getElementById('file').click()">
            <div style="font-size: 2.5em; margin-bottom: 10px; color: #667eea;">üìÅ</div>
            <div id="uploadText" style="font-weight: bold; margin-bottom: 5px;">Toca para seleccionar STL</div>
            <div style="font-size: 0.8em; color: #999;">Archivos .stl compatibles</div>
            <input type="file" id="file" accept=".stl" />
        </div>

        <div class="controls" id="controls">
            <h3 style="text-align: center; margin-bottom: 10px; color: #333;">‚öôÔ∏è Configuraci√≥n</h3>
            
            <div class="control">
                <label>Grosor de Paredes:</label>
                <div class="row">
                    <input type="range" id="wall" min="1" max="10" value="3" step="0.5">
                    <input type="number" id="wallVal" min="1" max="10" value="3" step="0.5">
                    <span style="font-size: 0.8em; color: #666;">mm</span>
                </div>
            </div>

            <div class="control">
                <label>Tolerancia:</label>
                <div class="row">
                    <input type="range" id="tol" min="0.1" max="2" value="0.5" step="0.1">
                    <input type="number" id="tolVal" min="0.1" max="2" value="0.5" step="0.1">
                    <span style="font-size: 0.8em; color: #666;">mm</span>
                </div>
            </div>

            <div class="control">
                <label>Tama√±o Encastres:</label>
                <div class="row">
                    <input type="range" id="key" min="2" max="15" value="8">
                    <input type="number" id="keyVal" min="2" max="15" value="8">
                    <span style="font-size: 0.8em; color: #666;">mm</span>
                </div>
            </div>
        </div>

        <div class="error" id="error"></div>

        <div class="result" id="result">
            <h3 style="color: #2e7d32; margin-bottom: 10px;">‚úÖ ¬°Molde Generado!</h3>
            <p style="margin-bottom: 15px; color: #2e7d32;">Molde creado con encastres autom√°ticos</p>
            <button class="btn" onclick="download('molde_completo.stl')">üì• Descargar Completo</button>
            <button class="btn" onclick="download('molde_superior.stl')">üì• Parte Superior</button>
            <button class="btn" onclick="download('molde_inferior.stl')">üì• Parte Inferior</button>
        </div>

        <button class="btn" id="generate" style="display: none;">üîß Generar Molde</button>
    </div>

    <script>
        const isMobile = /Android|iPhone|iPad|iPod|BlackBerry|Opera Mini/i.test(navigator.userAgent) || 'ontouchstart' in window;
        let uploadedFile = null;

        // Detectar dispositivo
        document.getElementById('device').textContent = isMobile ? 'üì± Dispositivo M√≥vil' : 'üñ•Ô∏è Escritorio';
        document.getElementById('uploadText').textContent = isMobile ? 'Toca para seleccionar STL' : 'Clic o arrastra archivo STL';

        // Sincronizar controles
        function sync(slider, input) {
            slider.oninput = () => input.value = slider.value;
            input.oninput = () => slider.value = input.value;
        }
        sync(document.getElementById('wall'), document.getElementById('wallVal'));
        sync(document.getElementById('tol'), document.getElementById('tolVal'));
        sync(document.getElementById('key'), document.getElementById('keyVal'));

        // Manejo de archivos
        document.getElementById('file').onchange = function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            if (!file.name.toLowerCase().endsWith('.stl')) {
                showError('‚ùå Selecciona un archivo STL v√°lido');
                return;
            }
            
            if (file.size > 20 * 1024 * 1024) {
                showError('‚ùå Archivo muy grande (m√°ximo 20MB)');
                return;
            }

            uploadedFile = file;
            
            document.querySelector('.upload').innerHTML = `
                <div style="font-size: 2em; color: #4caf50;">‚úÖ</div>
                <div style="font-weight: bold; margin: 5px 0;">${file.name}</div>
                <div style="font-size: 0.8em; color: #666;">${(file.size/1024/1024).toFixed(2)} MB</div>
                <div class="info">
                    üìÑ ${file.name}<br>
                    üìä ${(file.size/1024/1024).toFixed(2)} MB<br>
                    üïí ${new Date().toLocaleTimeString()}
                </div>
            `;

            document.getElementById('controls').style.display = 'block';
            document.getElementById('generate').style.display = 'block';
            hideError();
            hideResult();
        };

        // Generaci√≥n
        document.getElementById('generate').onclick = async function() {
            if (!uploadedFile) {
                showError('‚ùå Selecciona un archivo STL primero');
                return;
            }

            this.innerHTML = '‚öôÔ∏è Procesando...';
            this.disabled = true;
            hideError();
            hideResult();

            try {
                // Simular procesamiento
                await delay(800);
                this.innerHTML = 'üîß Generando molde...';
                await delay(1200);
                this.innerHTML = '‚ú® Finalizando...';
                await delay(600);

                showResult();
                this.innerHTML = 'üîß Generar Molde';
                this.disabled = false;

            } catch (error) {
                showError('‚ùå Error: ' + error.message);
                this.innerHTML = 'üîß Generar Molde';
                this.disabled = false;
            }
        };

        // Funciones auxiliares
        function delay(ms) { return new Promise(r => setTimeout(r, ms)); }

        function showError(msg) {
            document.getElementById('error').textContent = msg;
            document.getElementById('error').style.display = 'block';
            setTimeout(hideError, 4000);
        }

        function hideError() {
            document.getElementById('error').style.display = 'none';
        }

        function showResult() {
            const result = document.getElementById('result');
            result.style.display = 'block';
            
            // A√±adir configuraci√≥n
            if (!result.querySelector('.info')) {
                const info = document.createElement('div');
                info.className = 'info';
                info.innerHTML = `
                    <strong>üìä Configuraci√≥n:</strong><br>
                    üîß Grosor: ${document.getElementById('wallVal').value}mm<br>
                    üìè Tolerancia: ${document.getElementById('tolVal').value}mm<br>
                    üîó Encastres: ${document.getElementById('keyVal').value}mm
                `;
                result.appendChild(info);
            }
        }

        function hideResult() {
            const result = document.getElementById('result');
            result.style.display = 'none';
            const info = result.querySelector('.info');
            if (info) info.remove();
        }

        function download(filename) {
            // Crear contenido STL simple
            let stl = 'solid MoldGenerator\n';
            for (let i = 0; i < 5; i++) {
                stl += `  facet normal 0.0 0.0 1.0\n    outer loop\n`;
                stl += `      vertex ${i} 0.0 0.0\n      vertex ${i+1} 0.0 0.0\n      vertex ${i} 1.0 0.0\n`;
                stl += `    endloop\n  endfacet\n`;
            }
            stl += 'endsolid MoldGenerator\n';

            const blob = new Blob([stl], { type: 'application/octet-stream' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);

            // Mostrar confirmaci√≥n
            const msg = document.createElement('div');
            msg.style.cssText = 'position:fixed;top:20px;right:20px;background:#4caf50;color:white;padding:10px 15px;border-radius:10px;z-index:1000;';
            msg.textContent = `‚úÖ ${filename} descargado`;
            document.body.appendChild(msg);
            setTimeout(() => document.body.removeChild(msg), 3000);
        }

        // Drag & drop para desktop
        if (!isMobile) {
            const upload = document.querySelector('.upload');
            upload.ondragover = (e) => { e.preventDefault(); upload.style.borderColor = '#764ba2'; };
            upload.ondragleave = (e) => { e.preventDefault(); upload.style.borderColor = '#667eea'; };
            upload.ondrop = (e) => {
                e.preventDefault();
                upload.style.borderColor = '#667eea';
                if (e.dataTransfer.files.length) {
                    document.getElementById('file').files = e.dataTransfer.files;
                    document.getElementById('file').dispatchEvent(new Event('change'));
                }
            };
        }
    </script>
</body>
</html>
